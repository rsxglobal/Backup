<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>Sabio - JS</title>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap -->
    <!--<link rel="stylesheet" type="text/css" href="theme.css">
    <script type="text/javascript" src="myscripts.js"></script>-->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet">
    <link href="http://www.w3schools.com/lib/w3.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style>
        li.active {
            font-weight: bolder;
            text-decoration: underline;
        }

        .comment .comment {
            margin-left: 40px;
        }
    </style>
</head>
<body>
    <nav class="navbar-inverse">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">Sabio Full Stack Training</a>
            </div>
            <div id="navbar" class="collapse navbar-collapse">
                <ul class="nav navbar-nav">
                    <li><a href="postInput.html">1) Post Input</a></li>
                    <li><a href="showComments.html">2) Show Hidden Comments</a></li>
                    <li class=""><a href="addComments.html">3) Add Comments/Replies</a></li>
                    <li class="active"><a href="generate.html">4) Generate from JS Object</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
    </nav>

    <div class="container">
        <a class="btn btn-primary" role="button" data-toggle="collapse"
           href="#instructions" aria-expanded="false"
           aria-controls="instructions">
            Show Instructions
        </a>
        <div id="instructions" class="collapse">
            <div class="well instructions">
                <div>
                    The Comments for this blog page are NOT in the source of the page. You must generate these using a hard coded
                    Javascript Array
                </div>
                <div>
                    <span class="label label-success label-as-badge" id="test">1</span>
                    <span>
                        The page should have the same functionality as <a href="../Blogs/addComment.html">Add Comments/Replies</a>
                    </span>
                </div>

                <div>
                    <span class="label label-success label-as-badge">2</span>
                    <span>
                        The Javascript Array will look something like:
                    </span>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="blog-post">
                <h2 class="blog-post-title">The Best Blog Post Title</h2>
                <p class="blog-post-meta">by <a href="#">gregorio@sabio.la</a></p>

                <div id="lipsum">
                    <p>
                        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed eu sapien scelerisque, dictum nisi vehicula, tincidunt nunc. Quisque ut lacinia ipsum, ut fermentum nisl. Donec et volutpat lectus. Cras tincidunt imperdiet tincidunt. Mauris consequat vestibulum euismod. Phasellus velit mauris, laoreet ut lacus sagittis, ultricies dapibus arcu. Interdum et malesuada fames ac ante ipsum primis in faucibus. Donec nulla risus, imperdiet ut urna pulvinar, cursus dignissim turpis. Curabitur cursus vehicula facilisis. Donec odio enim, blandit id cursus vel, pretium et lectus. Curabitur id eros rhoncus, bibendum sem et, ultricies magna. Suspendisse placerat semper pellentesque. Aenean varius molestie elit, at elementum neque rutrum luctus. Mauris at nisi in neque aliquam pulvinar. Aenean eu aliquet nisl.
                    </p>
                </div>
            </div>
        </div>
        <div class="row commentsContainer">
            <div class="comments">
                <h2 class="title">There are 6 comments</h2>
                <!-- No Comments Here -->
            </div>
        </div>

        <div class="row newCommentForm">
            <div class="comments-form col-md-6">
                <h2 class="title">Add your comment</h2>
                <div id="frmContainer">
                    <form>

                        <div class="form-group">
                            <label for="title">Blog Title</label>
                            <input type="text" class="form-control comment-title" placeholder="Enter Title" />
                        </div>

                        <div class="form-group">
                            <label for="email">Email</label>
                            <input type="email" class="form-control comment-email" placeholder="Enter e-mail">
                        </div>

                        <div class="form-group">
                            <label for="content">Content</label>
                            <textarea class="form-control cmt-body" placeholder="Enter Content" rows="5"></textarea>
                        </div>

                        <button type="submit" id="submit" class="btn btn-default"><strong>Submit Blog!</strong></button>
                    </form>
                </div>
            </div>
        </div>
    </div><!-- /.container -->
    <footer class="text-center">
        <hr />
        This is the footer of the document. Here to take up space.
    </footer>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>

    <script src="http://sabioapi2.azurewebsites.net/scripts/sabio.js"></script>

    <!-- All your code goes below here-->

    <script type="text/javascript">

        sabio.page.activeReplyLink = null;

        var myCommentArray = [
                  {
                      "_id": "888888888888888888",
                      "index": 1,
                      "name": "Perez",
                      "message": ".......",
                      "subject": "enim officias",
                      "replies": [
                        {
                            "_id": "77777777777777777777",
                            "index": 0,
                            "name": "Ines for Perez",
                            "message": "...",
                            "subject": "reply subject consequat",
                            "replies": [{
                                "_id": "888888888888888888",
                                "index": 1,
                                "name": "Perez",
                                "message": ".......",
                                "subject": "Hello World!"
                            }]

                        }
                      ]
                  },
                   {
                       "_id": "999999999999",
                       "index": 0,
                       "name": "Shelton",
                       "message": "....a",
                       "subject": "enim irure",
                       "replies": [
                        {
                            "_id": "6666",
                            "index": 0,
                            "name": "Davey boy",
                            "message": "...",
                            "subject": "Chesse Potates",
                            "replies": [{
                                "_id": "88889998888888",
                                "index": 1,
                                "name": "Pez disperser",
                                "message": "JSON is cool!",
                                "subject": "Hello World!"
                            }]

                        }
                       ]
                   }
        ];

        var mynewCommentArray = [
                         {
                             "_id": "h12",
                             "index": 1,
                             "name": "Comequat",
                             "message": "Checkit",
                             "subject": "music",
                             "replies": [
                               {
                                   "_id": "horse7",
                                   "index": 0,
                                   "name": "Stanley",
                                   "message": "Hmm and Hmm",
                                   "subject": "I dunno, Yo kimba",
                                   "replies": [{
                                       "_id": "fish10n",
                                       "index": 1,
                                       "name": "Stupido",
                                       "message": "Keep you sun up and how",
                                       "subject": "F and it!"
                                   }]

                               }
                             ]
                         },
                          {
                              "_id": "tomatoe 45",
                              "index": 0,
                              "name": "Ined",
                              "message": "....a",
                              "subject": "radon posing, and tomatoe",
                              "replies": [
                               {
                                   "_id": "66sat66",
                                   "index": 0,
                                   "name": "Davey boy",
                                   "message": "...",
                                   "subject": "Chesse Potates",
                                   "replies": [{
                                       "_id": "88889998888888",
                                       "index": 1,
                                       "name": "Fan boy 12",
                                       "message": "JSON is cool!",
                                       "subject": "Hello World!"
                                   }]

                               }
                              ]
                          }
        ];

        sabio.page.startUp = function () {
            var cheese = mynewCommentArray;

            console.log("startup entered");
            sabio.page.processArray(cheese);
            $("#submit, .cmdAddComment").on("click", sabio.page.handlers.btnSubmit);
            $(".comments").on("click", ".reply", sabio.page.handlers.replyLink); //step 3 Modal button function for reply. Will work on reply link becuase of .reply
            $("#myModal").on("hidden.bs.modal", sabio.page.handlers.modalClosing);

        }

        sabio.page.handlers.modalClosing = function () {
            sabio.page.clearForm(); //optional if you want form to clear when closed
            sabio.page.activeReplyLink = null;

        }

        sabio.page.handlers.btnSubmit = function (event) {
            event.preventDefault();
            var data = sabio.page.readValues();
            sabio.page.setValues(data);
            sabio.page.clearForm();
            //sabio.page.activeReplyLink = null;//this will always clear the bottom form
        }
        sabio.page.handlers.replyLink = function (event) { //Modal step 1
            sabio.page.openReplyForm();
            event.preventDefault();
            sabio.page.activeReplyLink = this;
        }

        sabio.page.clearForm = function () {
            var activeForm = $("#frmContainer");
            if (sabio.page.activeReplyLink != null) {
                activeForm = $(".modal-body")
            }
            activeForm.find("form")[0].reset();
        }

        sabio.page.readValues = function () {
            var activeForm = $("#frmContainer"); //top form ID
            if (sabio.page.activeReplyLink != null) {
                activeForm = $(".modal-body")
            }
            var title = $(".comment-title", activeForm).val();
            var email = $(".comment-email", activeForm).val();
            var content = $(".cmt-body", activeForm).val();
            var data = {//JS can only return one value, so creat object with all values, then return statement
                title: title,
                email: email,
                content: content
            }
            return data;
        }

        sabio.page.processArray = function (commentArray, targetElement) {
            if (!commentArray) {
                return;
            }
            for (var i = 0; i < commentArray.length; i++) {
                var comment = commentArray[i];
                var data = {
                    title: comment.subject,
                    email: comment.name,
                    content: comment.message
                }
                var newComment = sabio.page.setValues(data, targetElement);
                if (comment.replies) {
                    sabio.page.processArray(comment.replies, newComment);
                }
            }

        }

        sabio.page.loadTemplate = function () {
            return $($("#template").html());

        }

        sabio.page.setValues = function (comment, container) {
            var template = sabio.page.loadTemplate(); //load template
            $(".media-heading", template).text(comment.title); //we change content inside template
            template.find(".comment-meta a").text(comment.email);
            $(".comment-meta a", template).prop("href", "mailto:" + comment.email);
            $(".comment-body p", template).text(comment.content); //load comments
            if (sabio.page.activeReplyLink == null && container == null) {
                $(".comments").append(template);
            }
            else {
                var containerComment;
                if (container) {
                    containerComment = container;
                }
                else {

                    containerComment = $(sabio.page.activeReplyLink).closest(".comment");//this finds parent element of class comment where you clicked reply
                }

                $(containerComment).append(template);//this inserts the template into the reply of comment you clicked
                $("#myModal").modal("hide");

            }

            var numberOfComments = $(".comment").length;
            $(".comments h2.title").text("There are " + numberOfComments + " " + "comments.");//this refreshes # of comments
            return template;
        }

        sabio.page.openReplyForm = function () { //step 2 set up function for open reply
            $("#myModal").modal("show"); //class for all reply tags
        }
    </script>

    <script type="text/html" id="template"><!--really important for template ops-->
        <div class="comment mediaclearfix">
            <div class="comment-avatar media-left">
                <img src="http://placehold.it/50x50" alt="avatar">
            </div>
            <div class="comment-content media-body clearfix">
                <h3 class="media-heading">Comment title</h3>
                <div class="comment-meta">By <a href="#">admin</a> | Today, 12:31</div>
                <div class="comment-body">
                    <p>Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo </p>
                    <a href="#" class="btn btn-gray more  reply"><i class="fa fa-reply"></i> Reply</a>
                </div>
            </div>
        </div>
    </script>

    <div class="modal fade" id="myModal">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Add Your Reply</h4>
                </div>
                <div class="modal-body">
                    <div class="comments-form">
                        <form>
                            <!--added form for reply to have same structure-->

                            <div class="form-group">
                                <label for="title">Blog Title</label>
                                <input type="text" class="form-control comment-title" placeholder="Enter Title" />
                            </div>

                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" class="form-control comment-email" placeholder="Enter e-mail">
                            </div>

                            <div class="form-group">
                                <label for="content">Content</label>
                                <textarea class="form-control cmt-body" placeholder="Enter Content" rows="5"></textarea>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input type="button" value="Submit Reply" class="btn btn-success cmdAddComment"
                           data-formid="#comment-form-reply">
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->
</body>
</html>